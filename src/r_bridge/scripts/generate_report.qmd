---
title: "Meta-Analysis Report"
subtitle: "`r params$intervention` vs `r params$comparison`"
author: "Generated by Cochrane Meta-Analysis MCP Server"
date: "`r Sys.Date()`"
format:
  html:
    code-fold: true
    toc: true
    toc-depth: 3
    theme: cosmo
    embed-resources: true
    fig-width: 10
    fig-height: 8
  pdf:
    documentclass: article
    geometry: margin=1in
    fig-width: 8
    fig-height: 6
params:
  n_studies: 0
  n_participants: 0
  intervention: "Intervention"
  comparison: "Control"
  outcome: "Primary outcome"
  pooled_or: 1.0
  ci_lower: 1.0
  ci_upper: 1.0
  p_value: 1.0
  I2: 0
  Q: 0
  Q_p: 1.0
  tau2: 0
  forest_plot_path: ""
  funnel_plot_path: ""
  studies: NULL
  interpretation: ""
  include_code: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = params$include_code,
  warning = FALSE,
  message = FALSE,
  fig.align = "center"
)
library(knitr)
```

## Executive Summary

This meta-analysis includes **`r params$n_studies`** studies with a total of **`r format(params$n_participants, big.mark=",")`** participants, comparing `r params$intervention` versus `r params$comparison` for the outcome `r params$outcome`.

::: {.callout-important}
## Key Finding

**Pooled Odds Ratio:** `r sprintf("%.3f", params$pooled_or)` (95% CI: `r sprintf("[%.3f, %.3f]", params$ci_lower, params$ci_upper)`)

**Statistical Significance:** `r if(params$p_value < 0.001) "p < 0.001 ***" else if(params$p_value < 0.01) "p < 0.01 **" else if(params$p_value < 0.05) "p < 0.05 *" else sprintf("p = %.3f", params$p_value)`

**Interpretation:** `r if(params$pooled_or < 1) sprintf("Treatment REDUCES odds by %.1f%%", (1 - params$pooled_or) * 100) else sprintf("Treatment INCREASES odds by %.1f%%", (params$pooled_or - 1) * 100)`
:::

## Methods

### Study Selection and Data Extraction

A systematic search identified `r params$n_studies` eligible studies meeting inclusion criteria. Data were extracted for:

- Study characteristics (authors, year, design)
- Participant demographics and sample sizes
- Outcome measures and event counts
- Study quality indicators

### Statistical Analysis

Meta-analysis was performed using the **random-effects model** with restricted maximum likelihood (REML) estimation, following Cochrane Handbook guidelines (Chapter 10).

**Software:** R version `r R.version.string`, metafor package

**Effect Measure:** Odds Ratio (OR) with 95% confidence intervals

## Results

### Forest Plot

The forest plot below displays individual study effects and the pooled estimate:

```{r forest-plot, echo=FALSE, fig.cap="Forest plot showing individual and pooled effect sizes"}
if(file.exists(params$forest_plot_path)) {
  knitr::include_graphics(params$forest_plot_path)
} else {
  cat("Forest plot not available\n")
}
```

**Figure 1.** Forest plot of meta-analysis. Each square represents an individual study, with size proportional to study weight. Horizontal lines represent 95% confidence intervals. The diamond represents the pooled effect estimate from the random-effects model.

### Pooled Effect Estimate

```{r results-table, echo=FALSE}
results_df <- data.frame(
  Metric = c(
    "Pooled Odds Ratio",
    "95% Confidence Interval",
    "Z-statistic",
    "p-value",
    "Number of Studies",
    "Total Participants"
  ),
  Value = c(
    sprintf("%.3f", params$pooled_or),
    sprintf("[%.3f, %.3f]", params$ci_lower, params$ci_upper),
    sprintf("%.2f", qnorm(params$p_value/2, lower.tail=FALSE)),
    if(params$p_value < 0.001) "< 0.001" else sprintf("%.4f", params$p_value),
    as.character(params$n_studies),
    format(params$n_participants, big.mark=",")
  )
)

kable(results_df, col.names = c("Metric", "Value"), align = c("l", "r"))
```

### Heterogeneity Assessment

```{r heterogeneity-table, echo=FALSE}
het_df <- data.frame(
  Statistic = c("I² (%)", "Q-statistic", "Degrees of Freedom", "p-value (Q-test)", "τ² (tau-squared)"),
  Value = c(
    sprintf("%.1f%%", params$I2),
    sprintf("%.2f", params$Q),
    as.character(params$n_studies - 1),
    sprintf("%.4f", params$Q_p),
    sprintf("%.3f", params$tau2)
  ),
  Interpretation = c(
    if(params$I2 <= 40) "Low" else if(params$I2 <= 60) "Moderate" else if(params$I2 <= 75) "Substantial" else "Considerable",
    if(params$Q_p < 0.10) "Significant" else "Not significant",
    "",
    "",
    ""
  )
)

kable(het_df, col.names = c("Statistic", "Value", "Interpretation"))
```

**Interpretation (Cochrane Handbook Section 10.10.2):**

`r if(params$I2 <= 40) {
  "**Low heterogeneity** (I² ≤ 40%): Heterogeneity might not be important. Studies show consistent effects."
} else if(params$I2 <= 60) {
  "**Moderate heterogeneity** (40% < I² ≤ 60%): May represent moderate heterogeneity. Consider investigating sources of variability."
} else if(params$I2 <= 75) {
  "**Substantial heterogeneity** (60% < I² ≤ 75%): Represents substantial heterogeneity. Investigate sources through subgroup analysis or meta-regression."
} else {
  "**Considerable heterogeneity** (I² > 75%): Considerable heterogeneity present. Question whether pooling studies is appropriate. Random-effects model recommended."
}`

### Individual Study Results

```{r study-table, echo=FALSE}
if(!is.null(params$studies) && nrow(params$studies) > 0) {
  kable(params$studies, digits = 3)
} else {
  cat("Individual study data not available\n")
}
```

## Publication Bias Assessment

### Funnel Plot

```{r funnel-plot, echo=FALSE, fig.cap="Funnel plot for publication bias assessment"}
if(file.exists(params$funnel_plot_path)) {
  knitr::include_graphics(params$funnel_plot_path)
} else {
  cat("Funnel plot not available\n")
}
```

**Figure 2.** Funnel plot for visual assessment of publication bias. In the absence of bias, studies should be symmetrically distributed around the pooled effect estimate. Asymmetry may suggest small-study effects or publication bias.

### Publication Bias Tests

::: {.callout-note}
Publication bias tests have limited power with fewer than 10 studies. Results should be interpreted with caution.
:::

## Clinical Interpretation

`r params$interpretation`

### Clinical Significance

```{r clinical-significance, echo=FALSE}
baseline_risk <- 0.20  # Assumed baseline risk (adjust as needed)
treated_risk <- baseline_risk * params$pooled_or / (1 - baseline_risk + baseline_risk * params$pooled_or)
absolute_risk_reduction <- baseline_risk - treated_risk
nnt <- if(absolute_risk_reduction > 0) 1 / absolute_risk_reduction else NA

cat(sprintf("Assuming a baseline risk of %.1f%%:\n\n", baseline_risk * 100))
cat(sprintf("- **Treated risk:** %.1f%%\n", treated_risk * 100))
cat(sprintf("- **Absolute risk reduction:** %.1f%%\n", absolute_risk_reduction * 100))
if(!is.na(nnt)) {
  cat(sprintf("- **Number Needed to Treat (NNT):** ~%.0f patients\n", nnt))
}
```

## Recommendations

Based on this meta-analysis:

1. **Effect Size:** The treatment demonstrates a `r if(params$pooled_or < 1) "protective" else "harmful"` effect with `r if(params$p_value < 0.05) "statistical significance" else "no statistical significance"`.

2. **Heterogeneity:** `r if(params$I2 > 60) "Substantial heterogeneity warrants investigation of sources through subgroup analysis or meta-regression." else "Low to moderate heterogeneity suggests relatively consistent effects across studies."`

3. **Quality Assessment:** Conduct risk of bias assessment using Cochrane RoB 2 tool for RCTs or ROBINS-I for non-randomized studies.

4. **Certainty of Evidence:** Perform GRADE assessment to evaluate the certainty of evidence.

5. **Further Research:** `r if(params$n_studies < 10) "Additional high-quality studies would strengthen the evidence base." else "The evidence base is substantial. Focus on understanding heterogeneity and patient-specific effects."`

## Limitations

1. This analysis assumes a random-effects model, which may not be appropriate if heterogeneity is very high.
2. Publication bias may be present, potentially affecting the pooled estimate.
3. Study-level covariates and subgroup effects were not explored in this primary analysis.
4. Risk of bias assessment is recommended for comprehensive evaluation.

## Conclusion

This meta-analysis of `r params$n_studies` studies (`r format(params$n_participants, big.mark=",")` participants) provides `r if(params$p_value < 0.05) "significant" else "insufficient"` evidence that `r params$intervention` `r if(params$pooled_or < 1 & params$p_value < 0.05) sprintf("reduces the odds of %s by %.1f%% compared to %s", params$outcome, (1-params$pooled_or)*100, params$comparison) else if(params$pooled_or > 1 & params$p_value < 0.05) sprintf("increases the odds of %s by %.1f%% compared to %s", params$outcome, (params$pooled_or-1)*100, params$comparison) else sprintf("affects %s compared to %s", params$outcome, params$comparison)`.

---

## Technical Details

### Statistical Methods

- **Model:** Random-effects meta-analysis
- **Estimation:** Restricted maximum likelihood (REML)
- **Effect Measure:** Odds ratio (OR)
- **Confidence Level:** 95%
- **Heterogeneity:** I², Q-test, τ²
- **Software:** R `r R.version.string`, metafor package

### Data Availability

Analysis code and data are available upon request.

### Compliance

This analysis follows:
- Cochrane Handbook for Systematic Reviews (Chapter 10)
- PRISMA reporting guidelines
- Cochrane statistical methods recommendations

---

*Report generated by Cochrane Meta-Analysis MCP Server v0.1.0*
*Date: `r Sys.Date()`*
*Reproducible research following Cochrane standards*
